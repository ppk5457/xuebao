<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>个人界面</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<link rel="stylesheet" href="../css/mui.min.css">
		<script type="text/javascript" src="../js/zoom/flexible.js" ></script>
		<style>
			body,html{
				margin: 0;
				padding: 0;
				width: 100%;
				height: 100%;
			}
			/*使用rem规定宽度,防止图片拉伸失帧*/
			.header_box{
				height: 6.25rem;
				width: 10rem;
				background-image: url(../images/me/self_bg.png);
				background-size: 100%;
				background-position: left top;
				background-repeat: no-repeat;
				position: relative;
				z-index: -1;
			}
			.header_box_i{
				position: absolute;
				top: 0;
				right: 0; 
				bottom: 0; 
				left: 0;
 				background-color: rgba(0, 0, 0, .4);
			}
			.avatar_box{
				position: relative;
				top: 1.666666rem;
			}
			.header_avatar{
				width: 2.083333rem;
				height: 2.083333rem;
				margin: 0 auto;
				border-radius:90px;
			}
			.header_avatar img{
				width: 100%;
				height: 100%;
				border-radius:90px;
			}
			.header_name{
				text-align: center;
				display: flex;
				justify-content: center;
				align-items: center;
				font-size: 0.444444rem;
				color: #FEFEFE;
				margin-top: 0.222222rem;
			}
			.header_name img{
				margin-left: 0.222222rem;
				width: 0.388888rem;
				height: 0.388888rem;
			}
			.header_age{
				text-align: center;
				color: #FEFEFE;
				margin-top: 0.288888rem;
				font-size: 0.388888rem;
			}
			.nav_list{
				width: 98%;
				margin: 0 auto;
				margin-top: -0.338888rem;
				z-index: 99;
			}
			.nav_list_ul{
				width: 100%;
				display: flex;
				background-color: rgb(255,255,255);
				padding: 0.388888rem 0;
				flex-wrap:wrap;
			}
			.nav_list_ul li{
				width: 33.33%;
				padding-bottom: 5px;
				text-align: center;
				border-right:1px solid rgb(190,190,190);
			}
			.li_last{
				border: none !important;
			}
			.balance{
				width: 0.583333rem;
				height: 0.611111rem;
			}
			.form{
				width: 0.486111rem;
				height: 0.555555rem;
			}
			.record{
				width: 0.458333rem;
				height: 0.569444rem;
			}
			.list_li_text{
				font-size: 0.388888rem;
				color: rgb(51,51,51);
				width: 33.33%;
				text-align: center;
				margin-top: -5px;
			}
			/*列表*/
			.function_list{
				width:100%;
				margin-top: 0.111111rem;
			}
			.list_ul{
				width: 100%;
			}
			.function_list_li{
				display: flex;
				justify-content: space-between;
				align-items: center;
				background-color: #FEFEFE;
				padding: 0.416666rem 0.388888rem;
				border-bottom: 2px solid rgb(240,240,240);
				position: relative;
			}
			.function_list_li_left{
				width: 40%;
				display: flex;
				align-items: center;
				font-size: 0.416666rem;
				color: rgb(51,51,51);
			}
			.function_list_li_left img{
				margin-right: 0.222222rem;
			}
			.function_list_li_right{
				width: 60%;
				text-align: right;
				padding-right: 2%;
			}
			
			.call_phone{
				background-color: #4ea9ef;
				padding:0;
				border-radius:28px;
				width: 3.247222rem;
				height: 0.777777rem;
				display: flex;
				justify-content: center;
				align-items: center;
				position: absolute;
				color: #FEFEFE;
				right: 5%;
				top: 50%;
				margin-top: -0.388888rem;
				font-size: 0.388888rem;
			}
			.call_phone img{
				width: 0.305555rem;
				height: 0.333333rem;
				margin-right: 0.138888rem;
			}
			.next_content{
				width: 0.166666rem;
				height: 0.291666rem;
			}
			.response{
				width: 0.527777rem;
				height: 0.555555rem;
			}
			.self_data{
				width: 0.402777rem;
				height: 0.430555rem;
			}
			.client_phone{
				width: 0.430555rem;
				height: 0.402777rem;
			}
			.set_some{
				width: 0.444444rem;
				height: 0.444444rem;
			}
			
			/*点击效果*/
			.function_list_li:active{
				background-color: rgb(240,240,240);
			}
		</style>
	</head>

	<body>
		<div class="content" id="msg-content">
			<div class="header_box">
				<i class="header_box_i"></i>
				<div class="avatar_box">
					<div class="header_avatar">
						<img src=""  v-lazy="ajaxUrl+studentDetail.studentImage"/>
					</div>
					<div class="header_name" v-text="studentDetail.name || '未登录'">
						<img align="center" :src="studentDetail.gender=='男'?'../images/teacher_list/male.png':'../images/teacher_list/female.png'" />
					</div>
					<div class="header_age">
						<span>{{studentDetail.city | city}}</span>&nbsp;&nbsp;|&nbsp;&nbsp;<span v-text="studentDetail.className|| '年级'"></span>
					</div>
				</div>
			</div>
			
			<div class="nav_list">
				<ul class="nav_list_ul">
					<li class="list_li balance_box">
						<img class="balance" src="../images/me/blance.png" />
					</li>
					<li class="list_li form_box">
						<img class="form" src="../images/me/order_form.png" />
					</li>
					<li class="list_li li_last record_box">
						<img class="record" src="../images/me/class_record.png" />
					</li>
					<div class="list_li_text balance_box">我的余额</div>
					<div class="list_li_text form_box">我的订单</div>
					<div class="list_li_text record_box">上课记录</div>
				</ul>
			</div>
			
			<div class="function_list">
				<ul class="function_list_ul">
					<li class="function_list_li" data-type = "1">
						<div class="function_list_li_left">
							<img class="response" align="center" src="../images/me/response.png"/>
							课堂反馈
						</div>
						<div class="function_list_li_right">
							<img class="next_content" align="center" src="../images/me/next_content.png" />
						</div>
					</li>		
					<li class="function_list_li" data-type ="2">
						<div class="function_list_li_left">
							<img class="self_data" align="center" src="../images/me/self_data.png"/>
							个人资料
						</div>
						<div class="function_list_li_right">
							<img class="next_content" align="center" src="../images/me/next_content.png" />
						</div>
					</li>
					<li class="function_list_li" data-type ="5">
						<div class="function_list_li_left">
							<img class="self_data" align="center" src="../images/me/plateform_data.png"/>
							平台资料
						</div>
						<div class="function_list_li_right">
							<img class="next_content" align="center" src="../images/me/next_content.png" />
						</div>
					</li>
					<li class="function_list_li" data-type = "3">
						<div class="function_list_li_left">
							<img class="client_phone" align="center" src="../images/me/client_phone.png"/>
							客服电话
						</div>
						<div class="function_list_li_right">
							<div class="call_phone"><img align="center" src="../images/me/phone_client.png" />028-83186163</div>
						</div>
					</li>
					<li class="function_list_li" data-type = "4">
						<div class="function_list_li_left">
							<img class="set_some" align="center" src="../images/me/set_some.png" />
							设置
						</div>
						<div class="function_list_li_right">
							<img class="next_content" align="center" src="../images/me/next_content.png" />
						</div>
					</li>
				</ul>
			</div>			
		</div>
	<!--取出加密值-->
	<input type="text" style="visibility:hidden" id="getPassword" value="" />	
	<script src="../js/mui.min.js"></script>
	<script type="text/javascript" src="../js/config.js" ></script>
	<script type="text/javascript" src="../js/hmac-sha1.js" ></script>
	<script type="text/javascript" src="../js/login_config.js" ></script>
	<script type="text/javascript" src="../js/vue.min.js" ></script>
	<script type="text/javascript" src="../js/vue-lazyload.js" ></script>
	<script type="text/javascript" src="../js/ajax.js" ></script>
	<script>
		mui.init({
			swipeBack:false //启用右滑关闭功能
		});
		
		mui.plusReady(function () {
					var studentData = null;
					var state = app.getState();
					console.log(JSON.stringify(state))
					if(state && state.data){
						showData();
					}				
				function showData(){
					var ajaxData = {
						url:'restful1/users/findStudent',
						data: {},
						type:'post'
					}
					ajax(ajaxData, function(data) {
						console.log(JSON.stringify(data))
							if(data.code == 401){
								plus.nativeUI.toast('type:401 您还未登录哟！');
								openView.incView('../login/login.html', 'login', '欢迎登陆');
							}else if(data.code == 200){
								vm.studentDetail = data.data;
								vm.ajaxUrl = ajaxUrl;
								studentData=JSON.stringify(data);
								state.data.address = data.data.address;
								state.data.city = data.data.city;
								state.data.cityName = data.data.cityName;
								state.data.className = data.data.className;
								state.data.clientId = data.data.clientId;
								state.data.createTime = data.data.createTime;
								state.data.gender = data.data.gender;
								state.data.id = data.data.id;
								state.data.mobilephone = data.data.mobilephone;
								state.data.name = data.data.name;
								state.data.school = data.data.school;
								state.data.studentClass = data.data.studentClass;
								state.data.userStatu = data.data.userStatu;		
							    app.setState(state);			 
							}else if(data.code == 1){
								plus.nativeUI.toast('type:1 登录失效！');
								openView.incView('../login/login.html', 'login', '欢迎登陆');
							}
						},true);
					}
					
			//添加newId自定义事件监听
			window.addEventListener('showView',function(event){
			   console.log('登录刷新');	
			   showData();
			});
			//我的余额
		    mui('.nav_list_ul').on('tap','.balance_box',function(){
		    	openView.nativeView('../pages_balance/balance.html', 'balance', '余额');
		    })
		    //我的订单
		    mui('.nav_list_ul').on('tap','.form_box',function(){
		    	openView.nativeView('../pages_indent/my_indent.html', 'my_indent', '我的订单','','none');
		    })
		    //上课记录
		    mui('.nav_list_ul').on('tap','.record_box',function(){
		    	openView.nativeView('../pages_class_register/class_record.html', 'class_record', '上课记录','','none');
		    })
		    
		    //课堂反馈
		    mui('.function_list_ul').on('tap','.function_list_li',function(){
		    	if(!studentData){
		    		 plus.nativeUI.toast('请先登录！');
		    	}
		    	var type = this.getAttribute('data-type');
		    	switch(type)
		    	{
		    		case '1':
		    		openView.nativeView('../pages_class_register/classroom_feedback.html', 'classroom_feedback', '课堂反馈','','none');
		    		break;
		    		case '2':
		    		//个人资料
		    		openView.nativeView('../pages_setting/selfDetail.html', 'selfDetail', '个人资料',{'studentData':studentData});
		    		break;
		    		case '3':
		    		//拨打电话
		    		plus.device.dial(028-83186163,true);
		    		break;
		    		case '4':
		    		openView.nativeView('../pages_setting/setting.html', 'setting', '设置');
		    		break;
		    		case '5':
		    		openView.nativeView('../pages_setting/platform_list.html', 'platform_list', '平台资料');
		    		break;
		    		default:
					  //异常处理
				}
		    })
		})
		Vue.use(VueLazyload, {
		  preLoad: 1.3,  
		  error: '../images/status/not_login_head.png',  
		  loading: '../images/status/not_login_head.png',  
		  attempt: 1  
		});
		Vue.filter('city',function(value){
				switch (value){
					case 1:
						return '成都市';
						break;
					default:
						return '新增城市';
						break;
				}
			})
		var vm = new Vue({
				el: '#msg-content',
				data: { 
					studentDetail:{},//教师动态数据
					studentDetailImg:{},
					ajaxUrl:''
				}			
			})
	</script>
</body>
</html>